# Requirements Archive: v1.0 Full Vision Implementation

**Archived:** 2026-02-16
**Status:** SHIPPED

This is the archived requirements specification for v1.0.
For current requirements, see `.planning/REQUIREMENTS.md` (created for next milestone).

---

## v1 Requirements

### Setup (SETUP)

| ID | Requirement | Priority | Status |
|----|-------------|----------|--------|
| SETUP-01 | Project scaffolding with Bun, TypeScript 5.5+, hexagonal architecture folder structure | Required | [x] Complete |
| SETUP-02 | Configure bun:sqlite with FTS5, WAL mode, and proper pragmas | Required | [x] Complete |
| SETUP-03 | Database schema with sessions, messages_fts, messages_meta, tool_uses, links, topics, extraction_state tables | Required | [x] Complete |
| SETUP-04 | CLI entry point with Commander.js v14 and extra-typings | Required | [x] Complete |

### Domain Layer (DOM)

| ID | Requirement | Priority | Status |
|----|-------------|----------|--------|
| DOM-01 | Session entity with ID, project path, timestamps, message counts | Required | [x] Complete |
| DOM-02 | Message entity with role, content, timestamp, session reference | Required | [x] Complete |
| DOM-03 | ToolUse entity with name, inputs, outputs, session reference | Required | [x] Complete |
| DOM-04 | Link entity with source, target, relationship type, weight | Required | [x] Complete |
| DOM-05 | ExtractionState entity for incremental sync tracking | Required | [x] Complete |
| DOM-06 | ProjectPath value object with encoding/decoding | Required | [x] Complete |
| DOM-07 | SearchQuery value object with query, filters, options | Required | [x] Complete |
| DOM-08 | SearchResult value object with ranking, snippets, highlights | Required | [x] Complete |
| DOM-09 | Port interfaces: ISessionRepository, IMessageRepository, ISearchService, ISessionSource, IEventParser | Required | [x] Complete |
| DOM-10 | PathDecoder domain service for encoded directory path decoding | Required | [x] Complete |
| DOM-11 | ContentExtractor domain service for text extraction from events | Required | [x] Complete |
| DOM-12 | QueryParser domain service for search query parsing | Required | [x] Complete |

### JSONL Parsing (PARSE)

| ID | Requirement | Priority | Status |
|----|-------------|----------|--------|
| PARSE-01 | Streaming JSONL parser using readline.createInterface (never load entire file) | Required | [x] Complete |
| PARSE-02 | Event classification by type: system, user, assistant, file-history-snapshot, summary | Required | [x] Complete |
| PARSE-03 | Message extraction from user and assistant events | Required | [x] Complete |
| PARSE-04 | Tool use extraction from assistant events | Required | [x] Complete |
| PARSE-05 | Thinking block extraction from assistant events | Required | [x] Complete |
| PARSE-06 | Summary extraction from summary events | Required | [x] Complete |
| PARSE-07 | Timestamp normalization to ISO 8601 | Required | [x] Complete |
| PARSE-08 | Graceful handling of malformed JSON lines (skip and log with line number) | Required | [x] Complete |
| PARSE-09 | Session discovery: locate all JSONL files in ~/.claude/projects/ | Required | [x] Complete |
| PARSE-10 | Encoded path decoding (or treat as opaque identifier) | Required | [x] Complete |

### Storage Adapters (STOR)

| ID | Requirement | Priority | Status |
|----|-------------|----------|--------|
| STOR-01 | SqliteSessionRepository implementing ISessionRepository | Required | [x] Complete |
| STOR-02 | SqliteMessageRepository implementing IMessageRepository with FTS5 | Required | [x] Complete |
| STOR-03 | Fts5SearchService implementing ISearchService with BM25 ranking | Required | [x] Complete |
| STOR-04 | FileSystemSessionSource implementing ISessionSource | Required | [x] Complete |
| STOR-05 | JsonlEventParser implementing IEventParser | Required | [x] Complete |
| STOR-06 | Batch database writes with configurable batch size | Required | [x] Complete |
| STOR-07 | Transaction-based extraction state updates (only update after commit) | Required | [x] Complete |
| STOR-08 | WAL checkpoint after bulk operations | Required | [x] Complete |

### Sync Command (SYNC)

| ID | Requirement | Priority | Status |
|----|-------------|----------|--------|
| SYNC-01 | Manual sync command: aidev memory sync | Required | [x] Complete |
| SYNC-02 | Incremental sync: only process new/changed content based on mtime and size | Required | [x] Complete |
| SYNC-03 | Sync progress indicator during extraction | Required | [x] Complete |
| SYNC-04 | Force re-sync option: --force to rebuild from scratch | Required | [x] Complete |
| SYNC-05 | Project-specific sync option: --project <name> | Required | [x] Complete |
| SYNC-06 | Session-specific sync option: --session <id> | Required | [x] Complete |
| SYNC-07 | Quiet mode for hooks: --quiet | Required | [x] Complete |
| SYNC-08 | Verbose mode for debugging: --verbose | Required | [x] Complete |

### Search Command (SRCH)

| ID | Requirement | Priority | Status |
|----|-------------|----------|--------|
| SRCH-01 | Full-text search: aidev memory search <query> | Required | [x] Complete |
| SRCH-02 | FTS5 MATCH operator (never = operator) for full-text queries | Required | [x] Complete |
| SRCH-03 | BM25 relevance ranking for results | Required | [x] Complete |
| SRCH-04 | Result snippets with surrounding context | Required | [x] Complete |
| SRCH-05 | Result limiting: --limit N (default 10) | Required | [x] Complete |
| SRCH-06 | Case sensitivity control: --ignore-case / --case-sensitive | Required | [x] Complete |
| SRCH-07 | Project filter: --project <name> | Required | [x] Complete |
| SRCH-08 | Time range filters: --since, --before, --days | Required | [x] Complete |
| SRCH-09 | Role filter: --role user/assistant/all | Required | [x] Complete |

### Output Formatting (OUT)

| ID | Requirement | Priority | Status |
|----|-------------|----------|--------|
| OUT-01 | Human-readable default output with clear structure | Required | [x] Complete |
| OUT-02 | JSON output flag: --json for programmatic consumption | Required | [x] Complete |
| OUT-03 | Quiet mode: --quiet for suppressed output | Required | [x] Complete |
| OUT-04 | Verbose mode: --verbose for detailed progress/debugging | Required | [x] Complete |
| OUT-05 | Consistent structure across all commands | Required | [x] Complete |
| OUT-06 | Context-sized results (fits within Claude's context window) | Required | [x] Complete |

### Statistics Command (STAT)

| ID | Requirement | Priority | Status |
|----|-------------|----------|--------|
| STAT-01 | Stats command: aidev memory stats | Required | [x] Complete |
| STAT-02 | Total counts: sessions, messages, tool uses | Required | [x] Complete |
| STAT-03 | Per-project breakdown | Required | [x] Complete |
| STAT-04 | Database size information | Required | [x] Complete |

### Session Navigation (NAV)

| ID | Requirement | Priority | Status |
|----|-------------|----------|--------|
| NAV-01 | List sessions: aidev memory list | Required | [x] Complete |
| NAV-02 | Session detail: aidev memory show <session-id> | Required | [x] Complete |
| NAV-03 | Session filtering by project | Required | [x] Complete |
| NAV-04 | Session filtering by date range | Required | [x] Complete |
| NAV-05 | Session search within list picker | Required | [x] Complete |

### Context Command (CTX)

| ID | Requirement | Priority | Status |
|----|-------------|----------|--------|
| CTX-01 | Context command: aidev memory context <project> | Required | [x] Complete |
| CTX-02 | Aggregate project context from recent sessions | Required | [x] Complete |
| CTX-03 | Days filter: --days N to limit recency | Required | [x] Complete |
| CTX-04 | Format option: --format brief/detailed | Required | [x] Complete |

### Related Command (REL)

| ID | Requirement | Priority | Status |
|----|-------------|----------|--------|
| REL-01 | Related command: aidev memory related <id> | Required | [x] Complete |
| REL-02 | Find sessions sharing common topics/entities | Required | [x] Complete |
| REL-03 | SqliteLinkRepository implementing ILinkRepository | Required | [x] Complete |
| REL-04 | Direct and indirect (2-hop) relationship queries | Required | [x] Complete |
| REL-05 | Weight-based relationship ranking | Required | [x] Complete |

### Hook Integration (HOOK)

| ID | Requirement | Priority | Status |
|----|-------------|----------|--------|
| HOOK-01 | Claude Code SessionStop hook triggers automatic sync | Required | [x] Complete |
| HOOK-02 | Session-specific sync (only sync the ended session) | Required | [x] Complete |
| HOOK-03 | Background/non-blocking execution | Required | [x] Complete |
| HOOK-04 | Graceful failure handling (don't block user) | Required | [x] Complete |
| HOOK-05 | Hook configuration documentation | Required | [x] Complete |

### Intelligent Extraction (EXTR)

| ID | Requirement | Priority | Status |
|----|-------------|----------|--------|
| EXTR-01 | Tool use tracking: query "what tools did Claude use?" | Required | [x] Complete |
| EXTR-02 | File modification tracking from tool uses | Required | [x] Complete |
| EXTR-03 | Topic/entity extraction from content | Required | [x] Complete |
| EXTR-04 | Session summary extraction and indexing | Required | [x] Complete |

### Error Handling (ERR)

| ID | Requirement | Priority | Status |
|----|-------------|----------|--------|
| ERR-01 | Graceful degradation on malformed files | Required | [x] Complete |
| ERR-02 | Clear error messages with file paths and line numbers | Required | [x] Complete |
| ERR-03 | Exit codes: 0 success, 1 user error, 2+ internal error | Required | [x] Complete |
| ERR-04 | Signal handling (Ctrl+C) with proper cleanup | Required | [x] Complete |
| ERR-05 | Database connection error handling | Required | [x] Complete |

### Quality (QUAL)

| ID | Requirement | Priority | Status |
|----|-------------|----------|--------|
| QUAL-01 | 95%+ test coverage at EACH metric (statements, branches, functions, lines) | Required | [~] Near-pass (94.49% functions, Bun limitation) |
| QUAL-02 | Unit tests for all domain entities and services | Required | [x] Complete |
| QUAL-03 | Integration tests for streaming parser with 10,000+ line files | Required | [x] Complete |
| QUAL-04 | Integration tests for interrupted sync recovery | Required | [x] Complete |
| QUAL-05 | Integration tests for concurrent CLI commands | Required | [x] Complete |

---

## Traceability

| Requirement | Phase | Status |
|-------------|-------|--------|
| SETUP-01 | Phase 1 | Complete |
| SETUP-02 | Phase 2 | Complete |
| SETUP-03 | Phase 2 | Complete |
| SETUP-04 | Phase 1 | Complete |
| DOM-01 through DOM-12 | Phases 1-2 | Complete |
| PARSE-01 through PARSE-10 | Phase 3 | Complete |
| STOR-01 through STOR-08 | Phase 4 | Complete |
| SYNC-01 through SYNC-08 | Phase 5 | Complete |
| SRCH-01 through SRCH-06 | Phase 6 | Complete |
| SRCH-07 through SRCH-09 | Phase 7 | Complete |
| OUT-01 through OUT-06 | Phase 7 | Complete |
| STAT-01 through STAT-04 | Phase 8 | Complete |
| NAV-01, NAV-03, NAV-04 | Phase 8 | Complete |
| NAV-02, NAV-05 | Phase 11 | Complete |
| CTX-01 through CTX-04 | Phase 9 | Complete |
| REL-01 through REL-05 | Phase 9 | Complete |
| HOOK-01 through HOOK-05 | Phase 10 | Complete |
| EXTR-01 through EXTR-04 | Phase 11 | Complete |
| ERR-01 through ERR-05 | Phase 12 | Complete |
| QUAL-01 through QUAL-05 | Phase 12 | Complete (QUAL-01 near-pass) |

---

## Milestone Summary

**Shipped:** 85 of 85 v1 requirements
**Adjusted:** QUAL-01 accepted with 94.49% function coverage (Bun tooling limitation, not implementation gap)
**Dropped:** None

---

*Archived: 2026-02-16 as part of v1.0 milestone completion*
