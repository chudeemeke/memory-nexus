---
phase: 12-polish-error-handling
plan: 10
type: execute
wave: 4
depends_on: ["12-07"]
files_modified:
  - package.json
  - vitest.config.ts
  - stryker.config.js
  - tests/smoke/cli-commands.test.ts
autonomous: true

must_haves:
  truths:
    - "All CLI commands have smoke tests (--help exits 0)"
    - "Mutation testing achieves 80%+ score on domain layer"
    - "Vitest configured for Stryker integration"
  artifacts:
    - path: "stryker.config.js"
      provides: "Mutation testing configuration"
    - path: "vitest.config.ts"
      provides: "Vitest config for Stryker"
    - path: "tests/smoke/cli-commands.test.ts"
      provides: "Smoke tests for all commands"
  key_links:
    - from: "stryker.config.js"
      to: "vitest.config.ts"
      via: "testRunner: vitest"
      pattern: "testRunner.*vitest"
---

<objective>
Set up mutation testing with Stryker and create CLI smoke tests.

Purpose: Validate test quality through mutation testing (80%+ score on domain layer) and ensure all CLI commands are accessible via smoke tests.

Output: Stryker configuration targeting domain layer, Vitest config for Stryker, and smoke tests for all CLI commands.
</objective>

<execution_context>
@C:\Users\Destiny\.claude/get-stuff-done/workflows/execute-plan.md
@C:\Users\Destiny\.claude/get-stuff-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-polish-error-handling/12-CONTEXT.md
@.planning/phases/12-polish-error-handling/12-RESEARCH.md
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure Stryker mutation testing</name>
  <files>
    package.json
    vitest.config.ts
    stryker.config.js
  </files>
  <action>
    Set up Stryker with Vitest runner:

    1. Update package.json:
       - Add devDependencies:
         - @stryker-mutator/core: ^9.0.0
         - @stryker-mutator/vitest-runner: ^9.0.0
         - @stryker-mutator/typescript-checker: ^9.0.0
         - vitest: ^3.0.0
       - Add scripts:
         - "mutation": "stryker run"
         - "mutation:domain": "stryker run --mutate 'src/domain/**/*.ts'"

    2. Create vitest.config.ts:
       - Configure for TypeScript
       - Set test include pattern to match existing tests
       - Configure coverage for comparison with Bun

    3. Create stryker.config.js:
       - testRunner: "vitest"
       - vitest: { configFile: "vitest.config.ts" }
       - checkers: ["typescript"]
       - tsconfigFile: "tsconfig.json"
       - mutate: ["src/domain/**/*.ts", "!src/**/*.test.ts"]
       - thresholds: { high: 80, low: 60, break: 80 }
       - reporters: ["html", "clear-text", "progress"]
       - concurrency: 4 (adjust based on CI resources)

    Note: Regular tests still use Bun (bun test).
    Vitest is ONLY for Stryker mutation testing.
  </action>
  <verify>
    Run: bun install (installs new dependencies)
    Run: bun run mutation:domain (verify Stryker runs)
    Verify mutation score >= 80% for domain layer.
  </verify>
  <done>
    Stryker configured with Vitest runner.
    Domain layer targeted for mutation testing.
    80% threshold enforced.
    Regular tests still use Bun.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create CLI smoke tests</name>
  <files>
    tests/smoke/cli-commands.test.ts
  </files>
  <action>
    Create smoke tests for all CLI commands:

    1. Create tests/smoke/cli-commands.test.ts:
       - Helper: runCommand(args: string[]): Promise<{ exitCode: number; stdout: string; stderr: string }>
         - Use Bun.spawn to run CLI
         - Capture stdout/stderr
         - Return exit code

       - Test suite: "CLI Smoke Tests"
         - Test: "memory --help exits 0"
         - Test: "memory sync --help exits 0"
         - Test: "memory search --help exits 0"
         - Test: "memory list --help exits 0"
         - Test: "memory stats --help exits 0"
         - Test: "memory context --help exits 0"
         - Test: "memory related --help exits 0"
         - Test: "memory show --help exits 0"
         - Test: "memory browse --help exits 0"
         - Test: "memory install --help exits 0"
         - Test: "memory uninstall --help exits 0"
         - Test: "memory status --help exits 0"
         - Test: "memory doctor --help exits 0"
         - Test: "memory export --help exits 0"
         - Test: "memory import --help exits 0"
         - Test: "memory purge --help exits 0"

       - Test: "unknown command shows error and exits 1"
       - Test: "missing required argument shows error"

    2. Ensure smoke tests are fast:
       - Only test --help (no actual operations)
       - No database access needed
       - Should complete in < 10 seconds total
  </action>
  <verify>
    Run: bun test tests/smoke/cli-commands.test.ts
    All smoke tests pass.
    Verify all commands accessible.
  </verify>
  <done>
    All CLI commands have smoke tests.
    --help exits 0 for all commands.
    Unknown commands handled correctly.
    Smoke tests complete quickly.
  </done>
</task>

</tasks>

<verification>
1. Run: bun install - Dependencies installed
2. Run: bun run mutation:domain - Stryker runs successfully
3. Run: bun test tests/smoke - All smoke tests pass
4. Verify mutation score >= 80%
</verification>

<success_criteria>
1. Stryker runs with Vitest runner
2. Domain layer mutation score >= 80%
3. All 16+ CLI commands have smoke tests
4. Unknown command handling verified
5. Smoke tests complete in < 10 seconds
</success_criteria>

<output>
After completion, create `.planning/phases/12-polish-error-handling/12-10-SUMMARY.md`
</output>
