---
phase: 07-filtering-and-output-formatting
plan: 06
type: execute
wave: 1
depends_on: []
files_modified:
  - src/presentation/cli/formatters/output-formatter.ts
  - src/presentation/cli/formatters/output-formatter.test.ts
  - src/presentation/cli/formatters/color.ts
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Search matches are visually distinct in terminal output"
    - "Highlighted text uses color that renders in Git Bash and Windows Terminal"
    - "Non-TTY output uses asterisk markers for visibility"
  artifacts:
    - path: "src/presentation/cli/formatters/output-formatter.ts"
      provides: "highlightSnippet function with colored highlighting"
      contains: "36m"
    - path: "src/presentation/cli/formatters/color.ts"
      provides: "cyan color function for highlight"
      contains: "export function cyan"
  key_links:
    - from: "src/presentation/cli/formatters/output-formatter.ts"
      to: "cyan function"
      via: "import from color.ts"
      pattern: "import.*cyan.*from"
---

<objective>
Fix match highlighting to be visible in Git Bash and Windows Terminal

Purpose: ANSI bold code alone is not visually distinct in many terminal emulators. Using a colored highlight (cyan) provides better visibility.
Output: Search matches highlighted with cyan color that renders across terminal types
</objective>

<execution_context>
@~/.claude/get-stuff-done/workflows/execute-plan.md
@~/.claude/get-stuff-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-filtering-and-output-formatting/07-UAT.md

@src/presentation/cli/formatters/output-formatter.ts
@src/presentation/cli/formatters/color.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add cyan highlight function to color utilities</name>
  <files>
    - src/presentation/cli/formatters/color.ts
  </files>
  <action>
1. In `src/presentation/cli/formatters/color.ts`:
   - Add a `cyan` function following the same pattern as green, red, yellow:
     ```typescript
     /**
      * Make text cyan (for highlighting matches).
      *
      * @param text Text to make cyan
      * @param useColor Whether to apply color (defaults to shouldUseColor())
      * @returns Cyan text or plain text
      */
     export function cyan(text: string, useColor?: boolean): string {
       return colorize(text, "36", useColor ?? shouldUseColor());
     }
     ```
   - Also add `boldCyan` for combined bold+cyan (more visible):
     ```typescript
     /**
      * Make text bold and cyan (for highly visible highlighting).
      *
      * @param text Text to make bold and cyan
      * @param useColor Whether to apply color (defaults to shouldUseColor())
      * @returns Bold cyan text or plain text
      */
     export function boldCyan(text: string, useColor?: boolean): string {
       return colorize(text, "1;36", useColor ?? shouldUseColor());
     }
     ```
  </action>
  <verify>
    Run `bun test color.ts` if tests exist, or just verify file compiles with `bun build src/presentation/cli/formatters/color.ts`
  </verify>
  <done>
    color.ts exports cyan and boldCyan functions
  </done>
</task>

<task type="auto">
  <name>Task 2: Update highlightSnippet to use boldCyan instead of just bold</name>
  <files>
    - src/presentation/cli/formatters/output-formatter.ts
    - src/presentation/cli/formatters/output-formatter.test.ts
  </files>
  <action>
1. In `src/presentation/cli/formatters/output-formatter.ts`:
   - Change import from `import { bold } from "./color.js"` to include boldCyan (or replace bold entirely since we only use it for highlighting)
   - Update `highlightSnippet` function:
     Current:
     ```typescript
     function highlightSnippet(snippet: string, useColor: boolean): string {
       if (!useColor) {
         return snippet
           .replace(/<mark>/g, "*")
           .replace(/<\/mark>/g, "*");
       }
       return snippet
         .replace(/<mark>/g, "\x1b[1m")
         .replace(/<\/mark>/g, "\x1b[0m");
     }
     ```
     Fixed (use bold+cyan for maximum visibility):
     ```typescript
     function highlightSnippet(snippet: string, useColor: boolean): string {
       if (!useColor) {
         return snippet
           .replace(/<mark>/g, "*")
           .replace(/<\/mark>/g, "*");
       }
       // Use bold+cyan (1;36m) for maximum visibility across terminals
       return snippet
         .replace(/<mark>/g, "\x1b[1;36m")
         .replace(/<\/mark>/g, "\x1b[0m");
     }
     ```
   - Note: We're hardcoding the ANSI code directly since useColor is already determined, avoiding function call overhead for each replacement

2. In `src/presentation/cli/formatters/output-formatter.test.ts`:
   - Update any tests that check for `\x1b[1m` to check for `\x1b[1;36m` instead
   - Add explicit test: "highlights matches with bold cyan in TTY mode"
  </action>
  <verify>
    Run `bun test output-formatter.test.ts` - all tests pass including updated highlight tests
  </verify>
  <done>
    highlightSnippet uses bold+cyan ANSI codes which render visibly in Git Bash and Windows Terminal
  </done>
</task>

</tasks>

<verification>
1. Run `bun test` - all tests pass
2. Manual test (if database has data):
   - `bun run src/presentation/cli/index.ts search test` in Git Bash
   - Matched text should appear in a visibly different color (cyan) with bold weight
   - If piped: `bun run src/presentation/cli/index.ts search test | cat` should show asterisk markers
</verification>

<success_criteria>
- color.ts exports cyan and boldCyan functions
- highlightSnippet uses bold+cyan (ANSI code 1;36m) for TTY output
- Non-TTY output still uses asterisk markers
- Matched text is visually distinct in Git Bash terminal
- All existing tests pass with updated expectations
</success_criteria>

<output>
After completion, create `.planning/phases/07-filtering-and-output-formatting/07-06-SUMMARY.md`
</output>
